@startuml
actor Usuario

participant "Request" as HttpRequest
participant "AuthenticateMiddleware" as Middleware
participant "JWTService" as JWTService
participant "UserRepository" as Repository

Usuario -> HttpRequest: Solicitud HTTP protegida (Authorization: Bearer <Token>)
HttpRequest -> Middleware: handle(Request, next)
Middleware -> JWTService: validateToken(token)
JWTService --> Middleware: UserId (si es v치lido) / Exception (si es inv치lido)

alt Token v치lido
    Middleware -> Repository: findById(UserId)
    Repository --> Middleware: User
    Middleware -> HttpRequest: next(Request) (procede al controlador)
    HttpRequest --> Usuario: Respuesta exitosa (200 OK)
else Token inv치lido
    Middleware --> HttpRequest: HTTP 401 Unauthorized
end
@enduml
